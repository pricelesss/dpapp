{"name":"DP App 主app JsBridge","tagline":"js bridge for main app of dianping","body":"# 点评Jsbridge v1.0.0\r\n\r\n## 概述\r\ndpapp是用于主app的jsbridge，为web页面提供调用native功能的能力，同时检测客户端环境，使得在app之外的浏览器中也能够尽可能的实现相同功能，以避免一个功能产生多套代码。\r\n\r\n## 引入\r\n\r\n- 使用cortex的efte-template新建项目，在业务代码中通过require引入。efte-template文档请移步这里。\r\n\r\n```\r\nvar DPApp = require('dpapp');\r\n```\r\n\r\n\r\n- 直接引入\r\n\r\n在html代码中引入\r\n```html\r\n<script src=\"http://i2.dpfile.com/mod/dpapp/1.0.0/dpapp.js\"></script>\r\n```\r\n\r\n### 接口调用说明\r\n\r\n#### 调用协议\r\n\r\n所有方法皆只接受一个javascript对象作为参数，其中success，fail分别为成功与失败后的回调。\r\n回调函数接受一个json对象作为参数。对象中的字段含义如下：\r\nstatus: 代表业务执行结果，其值为 success（成功），fail（失败）或 cancel（主动取消）\r\nresult: 回调函数的执行结果，其值为 next（需要多次回调，执行后不销毁方法），error（执行错误），complete（执行成功）\r\nerrMsg: 业务执行为fail时的错误信息\r\n\r\n所有方法调用之前，需要使用DPApp.ready确保native已就绪。\r\n\r\n示例：\r\n```javascript\r\n// 调出分享界面\r\nDPApp.ready(function(){\r\n  DPApp.share({\r\n    title:\"分享标题\",\r\n    desc:\"分享描述\",\r\n    image:\"http://www.dpfile.com/toevent/img/16d05c85a71b135edc39d197273746d6.png\",\r\n    url:\"http://m.dianping.com\",\r\n    success: function(){\r\n      alert('分享成功');\r\n    },\r\n    fail: function(e){\r\n      alert(e.errMsg);\r\n    }\r\n  });\r\n});\r\n```\r\n\r\n##接口说明\r\n\r\n### 获取用户信息\r\n```javascript\r\nDPApp.getUserInfo({\r\n  success: function(e){\r\n    console.log(e.dpid); // 用户的dpid\r\n    console.log(e.userId); // 用户id\r\n    console.log(e.token); // 用户token\r\n  }\r\n});\r\n```\r\n\r\n### 获取地理位置\r\n```javascript\r\nDPApp.getUserInfo({\r\n  success: function(e){\r\n    console.log(e.lat); // 纬度\r\n    console.log(e.lng); // 经度\r\n    console.log(e.type); // 坐标系类型\r\n  }\r\n});\r\n```\r\n\r\n### 获取网络状态\r\n```javascript\r\nDPApp.getUserInfo({\r\n  success: function(e){\r\n    console.log(e.networkType); // 2g, 3g, 4g, wifi\r\n  }\r\n});\r\n```\r\n\r\n### 获取联系人列表\r\n```javascript\r\nDPApp.getContactList({\r\n  success: function(e){\r\n    console.log(e.contactList); // 联系人列表\r\n    console.log(e.authorized); // 用户是否授权\r\n  }\r\n});\r\n```\r\n\r\n### Ajax请求\r\n```javascript\r\nDPApp.ajax({\r\n  url: \"http://m.dianping.com/...\",\r\n  method: \"post\", // get 或 post\r\n  data: {}, // 请求数据\r\n  cacheType: 1, // \r\n  success: function(e){\r\n    console.log(e.data); // 联系人列表\r\n  }\r\n});\r\n```\r\n\r\n### ga统计\r\n```javascript\r\nDPApp.ga({\r\n  success: function(e){\r\n    console.log(e.contactList); // 联系人列表\r\n    console.log(e.authorized); // 用户是否授权\r\n  }\r\n});\r\n```\r\n\r\n\r\n### 上传图片\r\n\r\n```javascript\r\nDPApp.uploadImage({\r\n  uploadUrl: \"\", // 上传图片调用的mapi接口的url\r\n  extra: {}, // 业务参数\r\n  compressFactor: 1024, // 上传图片压缩到多少尺寸以下，单位为K\r\n  maxNum: 5,\r\n  success: function(e){\r\n    console.log(e.totalNum); // 图片上传张数\r\n    console.log(e.image); // 原始图片结果\r\n    console.log(e.progess); // start 开始上传, uploading 上传中, end 上传结束\r\n  }\r\n});\r\n```\r\n\r\n### 下载图片\r\n```javascript\r\nDPApp.downloadImage({\r\n  imageUrl: \"http://img5.douban.com/view/note/large/public/p22307117.jpg\",\r\n  success: function(){\r\n  }\r\n});\r\n```\r\n\r\n### 关闭webview\r\n```javascript\r\nDPApp.closeWindow();\r\n```\r\n\r\n### 第三方支付\r\n待补充\r\n```javascript\r\nDPApp.pay({\r\n  \r\n});\r\n```\r\n\r\n\r\n### 分享\r\n有些分享渠道包含标题和内容，有些只有内容。对于只有内容的渠道，默认会拼接 title 和 desc 参数。\r\n当设定了 content 参数时，则会直接使用该参数的取值。\r\n\r\n```javascript\r\nDPApp.share({\r\n  title:\"分享标题\",\r\n  desc:\"分享描述\",\r\n  content:\"分享内容\",\r\n  image:\"http://www.dpfile.com/toevent/img/16d05c85a71b135edc39d197273746d6.png\",\r\n  url:\"http://m.dianping.com\",\r\n  success: function(){\r\n    alert('分享成功');\r\n  }\r\n});\r\n```\r\n\r\n### 发送短信\r\n```javascript\r\nDPApp.sendSMS({\r\n  recipients: 13581887557,\r\n  content: \"短信内容\",\r\n  success: function(e){\r\n  }\r\n});\r\n```\r\n\r\n### 订阅消息\r\n\r\n```javascript\r\nDPApp.subscribe({\r\n  action: 'loginSuccess',\r\n  success: function(e){\r\n  }\r\n});\r\n```\r\n可选广播类型包括 \r\nloginSuccess: 登录成功\r\nswitchCity: 切换城市\r\nbackground: 应用切换到后台\r\nforeground: 应用切换回前台\r\n\r\n### 取消订阅\r\n```javascript\r\nDPApp.unsubscribe({\r\n  action: 'loginSuccess',\r\n  success: function(e){\r\n  }\r\n});\r\n```\r\n\r\n### 设置标题\r\n```javascript\r\nDPApp.setTitle({\r\n  title: \"标题\"\r\n});\r\n```\r\n\r\n### 设置导航栏按钮\r\n左侧第一个\r\n```javascript\r\nDPApp.setLLButton({\r\n  text: \"文字\",\r\n  icon: \"http://...\"    \r\n});\r\n```\r\n\r\n左侧第二个\r\n```javascript\r\nDPApp.setLRButton({\r\n  text: \"文字\",\r\n  icon: \"http://...\"    \r\n});\r\n```\r\n\r\n右侧第一个\r\n```javascript\r\nDPApp.setRLButton({\r\n  text: \"文字\",\r\n  icon: \"http://...\"    \r\n});\r\n```\r\n\r\n右侧第二个\r\n```javascript\r\nDPApp.setRRButton({\r\n  text: \"文字\",\r\n  icon: \"http://...\"    \r\n});\r\n```","google":"UA-60162191-1","note":"Don't delete this file! It's used internally to help with page regeneration."}